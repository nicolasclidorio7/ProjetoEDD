const K='todos_v1';const f=document.getElementById('f'), taskIn=document.getElementById('task'), list=document.getElementById('list'), clearDone=document.getElementById('clearDone'), clearAll=document.getElementById('clearAll');let todos=JSON.parse(localStorage.getItem(K)||'[]');function save(){localStorage.setItem(K,JSON.stringify(todos)); render()}function render(){list.innerHTML=todos.map((t,i)=>`<li data-i="${i}" class="${t.done?'done':''}"><label><input class="chk" type="checkbox" ${t.done?'checked':''}/> ${esc(t.text)}</label><div><button class="d">Excluir</button></div></li>`).join('')}function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;')}f.addEventListener('submit',e=>{e.preventDefault();todos.push({text:taskIn.value.trim(),done:false,t:Date.now()});taskIn.value='';save()});list.addEventListener('click',e=>{const li=e.target.closest('li'); if(!li) return; const i=Number(li.dataset.i); if(e.target.classList.contains('d')){todos.splice(i,1);save()} if(e.target.classList.contains('chk')){todos[i].done = e.target.checked; save()}})clearDone.addEventListener('click',()=>{todos=todos.filter(t=>!t.done);save()});clearAll.addEventListener('click',()=>{if(confirm('Limpar todas?')){todos=[];save()}});render();